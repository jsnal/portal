//*title=Gitweb Setup
//*date=07/22/19
//*filetype=guide
### Installing the Gitweb interface

---

Install git and gitweb

```
$ sudo apt install git gitweb
```

### Configure the gitweb.conf

---

```
$ vi /etc/gitweb.conf
```

Your config should look something like this:

```
$projectroot = '/srv/git/';
$git_temp = "/tmp";
$projects_list = $projectroot;
$site_name = "Example Title";
$my_uri = "/";
$home_link = '/';
$stylesheets = ("/gitweb.css");
$favicon = "/git-favicon.png";
$logo = "/git-logo.png";

$projects_list_description_width = 100;
$feature{'blame'}{'default'} = [1];
```

### Configure Apache Webserver

---

Depending on how your Apache webserver is setup, these steps may vary.

```
$ vi /etc/apache2/sites-available/<CONFIG>
```

Add this to your site config in order to enable the cgi mod for all pages

```
Options +ExecCGI +FollowSymLinks
```

Enable the CGI mod itself

```
$ a2enmod cgi
```

You may also want to configure your gitweb apache conf

```
$ vi /etc/apache2/conf-available/gitweb.conf
```

Add this if you are using a subdirectory within apache i.e `http://localhost/gitweb`

```
Alias /<DIRECTORY> /usr/share/gitweb
```

and change the $my_uri and $home_link in your /etc/gitweb.conf

```
$my_uri = "/<DIRECTORY>";
$home_link = "/<DIRECTORY>";
```

### Setting up the Git Server

---

Create a git account with a `.ssh` directory

```
$ sudo adduser git
$ su git
$ cd
$ mkdir .ssh && chmod 700 .ssh
$ touch .ssh/authorized_keys && chmod 600 .ssh/authorized_keys
```

Add your ssh keys to the `.ssh/authorized_keys` file

```
# On your localbox

$ cat .ssh/id_rsa.pub
```

Init a bare repo in /srv/git

```
$ cd /srv/git
$ mkdir project.git
$ cd project.git
$ git init --bare
```

You can now clone and push to that ssh location

```
# On your localbox

$ mkdir project && cd project
$ cat "Project Repo" >> README.md
$ git add . && git commit -m "first commit"
$ git remote add origin git@gitserver:/srv/git/project.git
$ git push origin master
```

You can also clone, pull and fetch just like normal

If you want to add a new computer just append their key to `.ssh/authorized_keys` (you may need to restart the ssh service)

To add a new repo you need to make sure it has permissions

```
$ cd /srv/git
$ mkdir project_new.git
$ cd project_new.git && git init --bare
$ ls -la
total 16K
drwxr-xr-x 4 root git  4.0K Jul 22 16:01 ./
drwxr-xr-x 3 root git  4.0K Jul 20 21:33 ../
drwxrwxr-x 7 root git  4.0K Jul 22 15:50 project.git/
drwxrwxr-x 7 root root 4.0K Jul 22 16:04 project_new.git/

# Change the group to git

$ sudo chown -R :git project_new.git/
$ ls -la
total 16K
drwxr-xr-x 4 root git 4.0K Jul 22 16:01 ./
drwxr-xr-x 3 root git 4.0K Jul 20 21:33 ../
drwxrwxr-x 7 root git 4.0K Jul 22 15:50 project.git/
drwxrwxr-x 7 root git 4.0K Jul 22 16:04 project_new.git/
```
